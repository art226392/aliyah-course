<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aliyah Course - Assessment 1</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Unified Stylesheet -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header class="quiz-header">
        <h1>Assessment 1</h1>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="stats-container">
          <div id="question-counter">Answered: 0 / 15</div>
          <div id="timer">Time Left: 04:00</div>
        </div>
      </header>

      <form id="quiz-form">
        <div id="questions-wrapper">
          <!-- Questions will be dynamically inserted here by JavaScript -->
        </div>
        <button type="submit" id="submit-btn" disabled>
          Submit Assessment
        </button>
      </form>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="modal-overlay">
      <div class="modal-content">
        <h2>Assessment Complete</h2>
        <div id="score-percentage">0%</div>
        <div id="grade-level"></div>
        <p id="feedback-text"></p>
        <div id="answer-review"></div>
        <div class="modal-buttons">
          <a href="index.html" class="nav-btn secondary">Return to Lecture</a>
          <button id="retry-btn" class="nav-btn secondary">Retry Quiz</button>
          <!-- This button is hidden by default and shown on pass -->
          <a href="#" id="next-lecture-btn" class="nav-btn">Next Lecture →</a>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- QUIZ DATA ---
        const quizQuestions = [
          {
            question:
              "What is the central theme of the Aliyah course as described in the introduction?",
            options: [
              "The history of modern politics in the Middle East",
              "The return of the Jewish people to their ancestral homeland in Israel",
              "A study of ancient biblical languages",
              "The geography of the Mediterranean region",
            ],
            answer: 1,
          },
          {
            question:
              "According to the text, what is the primary biblical basis for Aliyah?",
            options: [
              "The Mosaic Law",
              "The Davidic Kingdom",
              "The Abrahamic Covenant",
              "The Book of Revelation",
            ],
            answer: 2,
          },
          {
            question:
              "The Abrahamic Covenant's fulfillment is conditional on what?",
            options: [
              "The worthiness of the Jewish people",
              "The political climate of the world",
              "The unchanging character and purposes of God",
              "The support of other nations",
            ],
            answer: 2,
          },
          {
            question:
              "According to the Apostle Paul in Romans 11, the restoration of Israel is described as being like what for the world?",
            options: [
              "A new beginning",
              "A political shift",
              "Life from the dead",
              "A cultural revolution",
            ],
            answer: 2,
          },
          {
            question: "Who were the pioneers of the First Aliyah?",
            options: [
              "Holocaust survivors",
              "Refugees from Arab lands",
              "Early Jewish immigrants in the late 19th century",
              "Russian intellectuals in the 1970s",
            ],
            answer: 2,
          },
          {
            question:
              "What is the described role of Christians in the story of Aliyah?",
            options: [
              "Passive observers",
              "Political opponents",
              "Advocates, intercessors, and practical supporters",
              "Solely financial donors",
            ],
            answer: 2,
          },
          {
            question:
              "The text suggests Christians should support Aliyah primarily out of a sense of:",
            options: [
              "Historical guilt",
              "Political obligation",
              "Duty and obligation",
              "Love, appreciation, and recognition of spiritual debt",
            ],
            answer: 3,
          },
          {
            question:
              "The modern-day Aliyah is presented as a testament to what?",
            options: [
              "The success of international diplomacy",
              "Human resilience and determination",
              "God's faithfulness to His ancient promises",
              "The economic power of the Jewish diaspora",
            ],
            answer: 2,
          },
          {
            question:
              "Besides biblical foundations, the dissertation will also explore:",
            options: [
              "Architectural styles in Jerusalem",
              "The history of the Hebrew language",
              "Historical expressions and contemporary challenges of Aliyah",
              "The agricultural techniques of early pioneers",
            ],
            answer: 2,
          },
          {
            question:
              "Whose voices are specifically mentioned to be highlighted in the dissertation?",
            options: [
              "Famous Israeli politicians",
              "Key Christian leaders and organizations involved in Aliyah",
              "Renowned secular historians",
              "United Nations officials",
            ],
            answer: 1,
          },
          {
            question:
              "The dissertation aims to demonstrate that Aliyah is a __________ part of God's redemptive plan.",
            options: [
              "peripheral and minor",
              "recent and temporary",
              "central and pivotal",
              "controversial and debatable",
            ],
            answer: 2,
          },
          {
            question:
              "The return of the Jewish people to their homeland is said to set the stage for what climactic events?",
            options: [
              "A new era of global peace",
              "The establishment of a world government",
              "The coming of the Messiah and His kingdom",
              "The final resolution of all political conflicts",
            ],
            answer: 2,
          },
          {
            question:
              "Which Old Testament prophet is quoted at the end of the introduction with the words 'The ransomed of the Lord shall return'?",
            options: ["Jeremiah", "Ezekiel", "Daniel", "Isaiah"],
            answer: 3,
          },
          {
            question:
              "What did God promise to give Abraham's descendants as an 'everlasting possession'?",
            options: [
              "Great wealth and riches",
              "The land of Israel",
              "Wisdom and knowledge",
              "Dominion over all other nations",
            ],
            answer: 1,
          },
          {
            question:
              "The text describes the ingathering of Jewish immigrants as coming from where?",
            options: [
              "Only from Europe and Russia",
              "Primarily from North America",
              "The four corners of the earth",
              "Neighboring Middle Eastern countries",
            ],
            answer: 2,
          },
        ];

        // --- DOM ELEMENTS ---
        const questionsWrapper = document.getElementById("questions-wrapper");
        const quizForm = document.getElementById("quiz-form");
        const submitBtn = document.getElementById("submit-btn");
        const progressBar = document.getElementById("progress-bar");
        const questionCounter = document.getElementById("question-counter");
        const timerEl = document.getElementById("timer");
        const resultsModal = document.getElementById("results-modal");
        const scorePercentageEl = document.getElementById("score-percentage");
        const gradeLevelEl = document.getElementById("grade-level");
        const feedbackTextEl = document.getElementById("feedback-text");
        const retryBtn = document.getElementById("retry-btn");
        const answerReviewEl = document.getElementById("answer-review");
        const nextLectureBtn = document.getElementById("next-lecture-btn");

        // --- STATE VARIABLES ---
        let userAnswers = new Array(quizQuestions.length).fill(null);
        let timerInterval;
        let timeLeft = 240; // 4 minutes in seconds
        let quizInProgress = true;

        // --- FUNCTIONS ---

        /**
         * Renders the questions and options to the DOM.
         */
        function renderQuestions() {
          let questionsHTML = "";
          quizQuestions.forEach((q, index) => {
            questionsHTML += `
              <div class="question-block">
                <h2>${index + 1}. ${q.question}</h2>
                <ul class="options-list" data-question-index="${index}">
                  ${q.options
                    .map((opt, i) => `<li data-option-index="${i}">${opt}</li>`)
                    .join("")}
                </ul>
              </div>`;
          });
          questionsWrapper.innerHTML = questionsHTML;
        }

        /**
         * Handles the user selecting an answer.
         * @param {Event} e The click event.
         */
        function handleOptionSelect(e) {
          if (!quizInProgress || !e.target.matches("li")) return;

          const questionIndex = e.target.parentElement.dataset.questionIndex;
          const optionIndex = e.target.dataset.optionIndex;

          userAnswers[questionIndex] = parseInt(optionIndex);

          // Update visual selection
          const options = e.target.parentElement.querySelectorAll("li");
          options.forEach((opt) => opt.classList.remove("selected"));
          e.target.classList.add("selected");

          updateProgress();
        }

        /**
         * Updates the progress bar and question counter.
         */
        function updateProgress() {
          const answeredCount = userAnswers.filter((a) => a !== null).length;
          const progress = (answeredCount / quizQuestions.length) * 100;
          progressBar.style.width = `${progress}%`;
          questionCounter.textContent = `Answered: ${answeredCount} / ${quizQuestions.length}`;
          submitBtn.disabled = answeredCount !== quizQuestions.length;
        }

        /**
         * Starts the 4-minute countdown timer.
         */
        function startTimer() {
          timerInterval = setInterval(() => {
            timeLeft--;
            const mins = Math.floor(timeLeft / 60)
              .toString()
              .padStart(2, "0");
            const secs = (timeLeft % 60).toString().padStart(2, "0");
            timerEl.textContent = `Time Left: ${mins}:${secs}`;

            if (timeLeft <= 0) {
              timerEl.textContent = "Time's Up!";
              showResults(); // Auto-submit when time runs out
            }
          }, 1000);
        }

        /**
         * Calculates score, displays results, and enforces pass/fail logic.
         */
        function showResults() {
          if (!quizInProgress) return; // Prevent multiple submissions
          quizInProgress = false;
          clearInterval(timerInterval);

          let score = 0;
          userAnswers.forEach((answer, index) => {
            if (answer === quizQuestions[index].answer) {
              score++;
            }
          });

          const percentage = Math.round((score / quizQuestions.length) * 100);
          scorePercentageEl.textContent = `${percentage}%`;

          // NEW: Enforce 80% pass condition
          if (percentage >= 80) {
            gradeLevelEl.textContent = "PASS";
            gradeLevelEl.className = "grade-pass";
            feedbackTextEl.textContent =
              "Excellent! You have a strong understanding of the material. You may proceed to the next lecture.";
            nextLectureBtn.style.display = "inline-block"; // Show button
            nextLectureBtn.href = "lecture2.html"; // Set link
          } else {
            gradeLevelEl.textContent = "FAIL";
            gradeLevelEl.className = "grade-fail";
            feedbackTextEl.textContent = `You scored ${percentage}%. A score of 80% is required to pass. Please review the material and try again.`;
            nextLectureBtn.style.display = "none"; // Hide button
          }

          renderAnswerReview();
          resultsModal.style.display = "flex";
        }

        /**
         * Generates the HTML for the answer review section in the modal.
         */
        function renderAnswerReview() {
          let reviewHTML = "";
          quizQuestions.forEach((q, index) => {
            const userAnswerIndex = userAnswers[index];
            const correctAnswerIndex = q.answer;
            const isCorrect = userAnswerIndex === correctAnswerIndex;
            const userAnswerText =
              userAnswerIndex !== null
                ? q.options[userAnswerIndex]
                : "No answer";

            reviewHTML += `
              <div class="review-item ${isCorrect ? "correct" : "incorrect"}">
                <p class="review-question">${index + 1}. ${q.question}</p>
                <p>Your answer: 
                  <span class="${
                    isCorrect ? "correct-answer" : "incorrect-answer"
                  }">${isCorrect ? "✓" : "✗"} ${userAnswerText}</span>
                </p>
                ${
                  !isCorrect
                    ? `<p>Correct answer: <span class="correct-answer">${q.options[correctAnswerIndex]}</span></p>`
                    : ""
                }
              </div>`;
          });
          answerReviewEl.innerHTML = reviewHTML;
        }

        // --- EVENT LISTENERS ---
        questionsWrapper.addEventListener("click", handleOptionSelect);
        quizForm.addEventListener("submit", (e) => {
          e.preventDefault();
          showResults();
        });
        retryBtn.addEventListener("click", () => {
          window.location.reload();
        });

        // --- INITIALIZATION ---
        renderQuestions();
        startTimer();
      });
    </script>
  </body>
</html>
