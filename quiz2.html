<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aliyah Course - Assessment 2</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Unified Stylesheet -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header class="quiz-header">
        <h1>Assessment 2</h1>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="stats-container">
          <div id="question-counter">Answered: 0 / 15</div>
          <div id="timer">Time Left: 04:00</div>
        </div>
      </header>

      <form id="quiz-form">
        <div id="questions-wrapper">
          <!-- Questions will be dynamically inserted here by JavaScript -->
        </div>
        <button type="submit" id="submit-btn" disabled>
          Submit Assessment
        </button>
      </form>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="modal-overlay">
      <div class="modal-content">
        <h2>Assessment Complete</h2>
        <div id="score-percentage">0%</div>
        <div id="grade-level"></div>
        <p id="feedback-text"></p>
        <div id="answer-review"></div>
        <div class="modal-buttons">
          <a href="lecture2.html" class="nav-btn secondary"
            >Return to Lecture</a
          >
          <button id="retry-btn" class="nav-btn secondary">Retry Quiz</button>
          <!-- This button is hidden by default and shown on pass -->
          <a href="#" id="next-lecture-btn" class="nav-btn"
            >Finish Course (For Now)</a
          >
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- QUIZ DATA ---
        const quizQuestions = [
          {
            question:
              "What is inseparably linked to God's plan of redemption for humanity?",
            options: [
              "The geography of the Middle East",
              "The history and destiny of Israel",
              "The rise of modern nations",
              "The development of religious philosophy",
            ],
            answer: 1,
          },
          {
            question:
              "What are the three key promises God makes to Abraham in the Abrahamic Covenant?",
            options: [
              "Wealth, power, and fame",
              "Wisdom, knowledge, and understanding",
              "Land, descendants, and blessing",
              "Health, long life, and happiness",
            ],
            answer: 2,
          },
          {
            question:
              "The fulfillment of the Abrahamic Covenant is dependent on what?",
            options: [
              "Abraham's performance and obedience",
              "The support of surrounding nations",
              "God's faithfulness",
              "The changing political landscape",
            ],
            answer: 2,
          },
          {
            question:
              "According to Exodus 19:5-6, Israel is called to be a special treasure to God and a:",
            options: [
              "Kingdom of warriors and a mighty nation",
              "Kingdom of priests and a holy nation",
              "Kingdom of scholars and a wise nation",
              "Kingdom of merchants and a prosperous nation",
            ],
            answer: 1,
          },
          {
            question:
              "What is described as Israel's primary calling as a 'light to the nations'?",
            options: [
              "To conquer other lands",
              "To be a living witness to the one true God",
              "To build the largest temple",
              "To create a global economy",
            ],
            answer: 1,
          },
          {
            question:
              "What does the text say is the ultimate result of Israel repeatedly breaking God's covenant?",
            options: [
              "Immediate forgiveness",
              "The covenant being nullified",
              "Exile from the land",
              "The loss of their identity",
            ],
            answer: 2,
          },
          {
            question:
              "The prophets foretold a restoration for Israel that was not just physical, but also:",
            options: ["Political", "Economical", "Spiritual", "Military"],
            answer: 2,
          },
          {
            question:
              "In Romans 11, what did Israel's temporary hardening lead to?",
            options: [
              "The end of the covenant",
              "The gospel being extended to the Gentiles",
              "The destruction of Jerusalem",
              "The loss of all promises",
            ],
            answer: 1,
          },
          {
            question:
              "Paul argues that Israel's future restoration will lead to what for the world?",
            options: [
              "Greater political turmoil",
              "Economic collapse",
              "Even greater riches, like 'life from the dead'",
              "A new set of laws",
            ],
            answer: 2,
          },
          {
            question:
              "What did Jesus affirm when He declared 'salvation is of the Jews'?",
            options: [
              "That salvation was only for Jewish people",
              "The ongoing validity of God's promises to Israel",
              "A new political movement",
              "The end of the old covenants",
            ],
            answer: 1,
          },
          {
            question:
              "What is the main point of Romans chapters 9-11 regarding Israel?",
            options: [
              "That the Church has completely replaced Israel",
              "That God's promises to Israel are irrevocable",
              "That Israel's role is finished",
              "That Gentiles are superior to Jews",
            ],
            answer: 1,
          },
          {
            question:
              "The book of Revelation portrays what group being sealed from the twelve tribes of Israel?",
            options: [
              "12,000 priests",
              "7,000 prophets",
              "144,000 people",
              "All the elders of Israel",
            ],
            answer: 2,
          },
          {
            question:
              "How does the New Testament relate the Church to Israel's covenant blessings?",
            options: [
              "The Church supersedes and eliminates Israel",
              "The Church is grafted into the blessings",
              "The Church and Israel have separate, unrelated blessings",
              "The Church's blessings are superior",
            ],
            answer: 1,
          },
          {
            question:
              "What is the modern-day return of the Jewish people to their homeland called?",
            options: [
              "The Exodus",
              "The Diaspora",
              "Aliyah",
              "The Great Return",
            ],
            answer: 2,
          },
          {
            question:
              "What are Christians called to do in response to God's ongoing work in Israel?",
            options: [
              "Remain neutral and observe",
              "Oppose the political state of Israel",
              "Pray for Jerusalem and support the gathering of His people",
              "Focus only on the Church's growth",
            ],
            answer: 2,
          },
        ];

        // --- DOM ELEMENTS ---
        const questionsWrapper = document.getElementById("questions-wrapper");
        const quizForm = document.getElementById("quiz-form");
        const submitBtn = document.getElementById("submit-btn");
        const progressBar = document.getElementById("progress-bar");
        const questionCounter = document.getElementById("question-counter");
        const timerEl = document.getElementById("timer");
        const resultsModal = document.getElementById("results-modal");
        const scorePercentageEl = document.getElementById("score-percentage");
        const gradeLevelEl = document.getElementById("grade-level");
        const feedbackTextEl = document.getElementById("feedback-text");
        const retryBtn = document.getElementById("retry-btn");
        const answerReviewEl = document.getElementById("answer-review");
        const nextLectureBtn = document.getElementById("next-lecture-btn");

        // --- STATE VARIABLES ---
        let userAnswers = new Array(quizQuestions.length).fill(null);
        let timerInterval;
        let timeLeft = 240; // 4 minutes in seconds
        let quizInProgress = true;

        // --- FUNCTIONS ---

        /**
         * Renders the questions and options to the DOM.
         */
        function renderQuestions() {
          let questionsHTML = "";
          quizQuestions.forEach((q, index) => {
            questionsHTML += `
              <div class="question-block">
                <h2>${index + 1}. ${q.question}</h2>
                <ul class="options-list" data-question-index="${index}">
                  ${q.options
                    .map((opt, i) => `<li data-option-index="${i}">${opt}</li>`)
                    .join("")}
                </ul>
              </div>`;
          });
          questionsWrapper.innerHTML = questionsHTML;
        }

        /**
         * Handles the user selecting an answer.
         * @param {Event} e The click event.
         */
        function handleOptionSelect(e) {
          if (!quizInProgress || !e.target.matches("li")) return;

          const questionIndex = e.target.parentElement.dataset.questionIndex;
          const optionIndex = e.target.dataset.optionIndex;

          userAnswers[questionIndex] = parseInt(optionIndex);

          // Update visual selection
          const options = e.target.parentElement.querySelectorAll("li");
          options.forEach((opt) => opt.classList.remove("selected"));
          e.target.classList.add("selected");

          updateProgress();
        }

        /**
         * Updates the progress bar and question counter.
         */
        function updateProgress() {
          const answeredCount = userAnswers.filter((a) => a !== null).length;
          const progress = (answeredCount / quizQuestions.length) * 100;
          progressBar.style.width = `${progress}%`;
          questionCounter.textContent = `Answered: ${answeredCount} / ${quizQuestions.length}`;
          submitBtn.disabled = answeredCount !== quizQuestions.length;
        }

        /**
         * Starts the 4-minute countdown timer.
         */
        function startTimer() {
          timerInterval = setInterval(() => {
            timeLeft--;
            const mins = Math.floor(timeLeft / 60)
              .toString()
              .padStart(2, "0");
            const secs = (timeLeft % 60).toString().padStart(2, "0");
            timerEl.textContent = `Time Left: ${mins}:${secs}`;

            if (timeLeft <= 0) {
              timerEl.textContent = "Time's Up!";
              showResults(); // Auto-submit when time runs out
            }
          }, 1000);
        }

        /**
         * Calculates score, displays results, and enforces pass/fail logic.
         */
        function showResults() {
          if (!quizInProgress) return; // Prevent multiple submissions
          quizInProgress = false;
          clearInterval(timerInterval);

          let score = 0;
          userAnswers.forEach((answer, index) => {
            if (answer === quizQuestions[index].answer) {
              score++;
            }
          });

          const percentage = Math.round((score / quizQuestions.length) * 100);
          scorePercentageEl.textContent = `${percentage}%`;

          // NEW: Enforce 80% pass condition
          if (percentage >= 80) {
            gradeLevelEl.textContent = "PASS";
            gradeLevelEl.className = "grade-pass";
            feedbackTextEl.textContent =
              "Congratulations! You have successfully completed the course assessments.";
            nextLectureBtn.style.display = "inline-block"; // Show button
            nextLectureBtn.href = "#"; // No next lecture yet
          } else {
            gradeLevelEl.textContent = "FAIL";
            gradeLevelEl.className = "grade-fail";
            feedbackTextEl.textContent = `You scored ${percentage}%. A score of 80% is required to pass. Please review the material and try again.`;
            nextLectureBtn.style.display = "none"; // Hide button
          }

          renderAnswerReview();
          resultsModal.style.display = "flex";
        }

        /**
         * Generates the HTML for the answer review section in the modal.
         */
        function renderAnswerReview() {
          let reviewHTML = "";
          quizQuestions.forEach((q, index) => {
            const userAnswerIndex = userAnswers[index];
            const correctAnswerIndex = q.answer;
            const isCorrect = userAnswerIndex === correctAnswerIndex;
            const userAnswerText =
              userAnswerIndex !== null
                ? q.options[userAnswerIndex]
                : "No answer";

            reviewHTML += `
              <div class="review-item ${isCorrect ? "correct" : "incorrect"}">
                <p class="review-question">${index + 1}. ${q.question}</p>
                <p>Your answer: 
                  <span class="${
                    isCorrect ? "correct-answer" : "incorrect-answer"
                  }">${isCorrect ? "✓" : "✗"} ${userAnswerText}</span>
                </p>
                ${
                  !isCorrect
                    ? `<p>Correct answer: <span class="correct-answer">${q.options[correctAnswerIndex]}</span></p>`
                    : ""
                }
              </div>`;
          });
          answerReviewEl.innerHTML = reviewHTML;
        }

        // --- EVENT LISTENERS ---
        questionsWrapper.addEventListener("click", handleOptionSelect);
        quizForm.addEventListener("submit", (e) => {
          e.preventDefault();
          showResults();
        });
        retryBtn.addEventListener("click", () => {
          window.location.reload();
        });

        // --- INITIALIZATION ---
        renderQuestions();
        startTimer();
      });
    </script>
  </body>
</html>
